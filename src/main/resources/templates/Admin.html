<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <title>AdminPanel</title>
</head>
<body>
<div class="container">
  <h1 class="title">Users</h1>
  <div class="table-container">
    <table>
      <tr>
        <th>id</th>
        <th>Name</th>
        <th>Surname</th>
        <th>Email</th>
        <th>Role</th>
      </tr>
      <tr th:each="entry : ${usersWithRoles}">
        <td th:text="${entry.key.id}"></td>
        <td><a th:href="@{'/user/' + ${entry.key.id}}" th:text="${entry.key.username}"></a></td>
        <td th:text="${entry.key.lastname}"></td>
        <td th:text="${entry.key.email}"></td>
        <td th:text="${entry.value}"></td>
      </tr>
    </table>
  </div>

  <div class="form-container">
    <form method="post" action="/admin/add" class="add-user-form" th:object="${user}">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <label>
        <input type="text" name="username" placeholder="Name">
        <span th:if="${#fields.hasErrors('username')}" th:errors="*{username}">Username Error</span>
      </label>
      <label>
        <input type="text" name="lastname" placeholder="Surname">
        <span th:if="${#fields.hasErrors('lastname')}" th:errors="*{lastname}">Username Error</span>
      </label>
      <label>
        <input type="text" name="email" placeholder="Email">
        <span th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Username Error</span>
      </label>
      <label>
        <input type="text" name="password" placeholder="Password">
        <span th:if="${#fields.hasErrors('password')}" th:errors="*{password}">Username Error</span>
      </label>
      <input type="submit" value="Add User">
      <!-- Используем выпадающий список для выбора ID пользователя -->
      <label class="role-select-container">
        Role:
        <select name="role">
          <option value="ROLE_ADMIN">admin</option>
          <option value="ROLE_USER">user</option>
        </select>
      </label>
    </form>

    <!-- Форма для обновления пользователя -->
    <form method="post" action="/admin/update" class="update-user-form" th:object="${user}">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <!-- Вводим только существующие ID пользователей -->
      <label>
        <select name="id">
          <option th:each="userId : ${ids}" th:value="${userId}" th:text="${userId}"></option>
        </select>
      </label>
      <label>
        <input type="text" name="username" placeholder="New Name">
        <span th:if="${#fields.hasErrors('username')}" th:errors="*{username}">Username Error</span>
      </label>
      <label>
        <input type="text" name="lastname" placeholder="New Surname">
        <span th:if="${#fields.hasErrors('lastname')}" th:errors="*{lastname}">Username Error</span>
      </label>
      <label>
        <input type="text" name="email" placeholder="New Email">
        <span th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Username Error</span>
      </label>
      <label>
        <input type="text" name="password" placeholder="New Password">
        <span th:if="${#fields.hasErrors('password')}" th:errors="*{password}">Username Error</span>
      </label>
      <input type="submit" value="Update User">
    </form>

    <!-- Форма для удаления пользователя -->
    <form method="post" action="/admin/delete" class="delete-user-form">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <!-- Вводим только существующие ID пользователей -->
      <label>
        <select name="id">
          <option th:each="userId : ${ids}" th:value="${userId}" th:text="${userId}"></option>
        </select>
      </label>
      <input type="submit" value="Delete User">
    </form>
  </div>

  <div class="logout-button-wrapper">
    <form action="/logout" method="post" class="logout-form">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <input type="submit" value="Logout"/>
    </form>
  </div>
</div>
</body>
</html>
